<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Android Pattern R Calculator</title>
    <style>
        /* Overall Page Design */
        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(45deg, #eef2f3, #8e9eab);
            margin: 0;
            padding: 0;
        }
        /* Main Container */
        .container {
            max-width: 800px;
            margin: 40px auto;
            background: #fff;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }
        /* Header Styling */
        header {
            text-align: center;
            margin-bottom: 30px;
        }

            header h1 {
                margin: 10px 0;
                color: #333;
            }

            header p {
                color: #666;
                font-size: 18px;
            }
        /* Section Headings */
        section h2 {
            color: #444;
            border-bottom: 2px solid #ddd;
            padding-bottom: 8px;
            margin-bottom: 20px;
        }
        /* Forms and Inputs */
        form {
            margin-bottom: 20px;
        }

        label {
            font-weight: bold;
            display: block;
            margin-bottom: 8px;
        }

        input[type="text"] {
            width: 100%;
            padding: 10px;
            font-size: 16px;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
            margin-bottom: 10px;
        }

        button {
            background-color: #4CAF50;
            color: #fff;
            border: none;
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            border-radius: 4px;
        }

            button:hover {
                background-color: #45a049;
            }
        /* Result Card */
        .result {
            margin-top: 15px;
            padding: 20px;
            background: #f9f9f9;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            color: #333;
        }
        /* Permanent Custom Text Area */
        .customTextDisplay {
            margin-top: 15px;
            padding: 20px;
            background: #f9f9f9;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            color: #333;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Android Pattern R Calculator</h1>
            <p>A beautiful tool to compute the security measure of your Android graphic passwords.</p>
        </header>

        <!-- Pattern Calculator Section -->
        <section id="calculatorSection">
            <h2>Calculate r Value</h2>
            <form id="patternForm">
                <label for="pattern">Enter Pattern (e.g., 1236 or 1,2,3,6):</label>
                <input type="text" id="pattern" name="pattern" placeholder="e.g., 1236 or 1,2,3,6" required>
                <button type="submit">Compute r</button>
            </form>
            <div id="result" class="result"></div>
        </section>

        <!-- Permanent Custom Text Section -->
        <section id="customTextSection">
            <h2>Your Permanent Custom Text</h2>
            <!-- Change the text below to whatever permanent message you would like. -->
            <div id="customTextDisplay" class="customTextDisplay">
                Here is my permanent custom text. You can change this specific message in the source code.
            </div>
        </section>
    </div>

    <script>
        // Ensure the DOM is fully loaded before the script runs.
        document.addEventListener("DOMContentLoaded", function () {

            // Mapping of dot numbers to coordinates on a 3x3 grid.
            // 1: (0,0), 2: (1,0), 3: (2,0)
            // 4: (0,1), 5: (1,1), 6: (2,1)
            // 7: (0,2), 8: (1,2), 9: (2,2)
            var dotCoordinates = {
                1: { x: 0, y: 0 },
                2: { x: 1, y: 0 },
                3: { x: 2, y: 0 },
                4: { x: 0, y: 1 },
                5: { x: 1, y: 1 },
                6: { x: 2, y: 1 },
                7: { x: 0, y: 2 },
                8: { x: 1, y: 2 },
                9: { x: 2, y: 2 }
            };

            // Given two dots, if the line between them passes directly through another dot,
            // this function returns that intermediate dot (as a number). Otherwise, it returns null.
            function getIntermediate(a, b) {
                var p1 = dotCoordinates[a];
                var p2 = dotCoordinates[b];
                var midX = (p1.x + p2.x) / 2;
                var midY = (p1.y + p2.y) / 2;
                // Check if midX and midY are integers (i.e. there's a dot in between).
                if (midX % 1 === 0 && midY % 1 === 0) {
                    for (var key in dotCoordinates) {
                        if (dotCoordinates.hasOwnProperty(key)) {
                            var pt = dotCoordinates[key];
                            if (pt.x === midX && pt.y === midY) {
                                return parseInt(key, 10);
                            }
                        }
                    }
                }
                return null;
            }

            // Check if the pattern is "real" according to Android rules.
            // Rules checked:
            // 1. No repeated dots.
            // 2. For every consecutive move, if an intermediate dot exists between the two points,
            //    it must have been selected earlier in the pattern.
            function isValidPattern(pattern) {
                // Check for duplicates.
                for (var i = 0; i < pattern.length; i++) {
                    for (var j = i + 1; j < pattern.length; j++) {
                        if (pattern[i] === pattern[j]) {
                            return false;
                        }
                    }
                }
                // Check the intermediate rule.
                // For each consecutive pair, if there is an intermediate dot,
                // that dot must appear before the current move.
                for (var i = 1; i < pattern.length; i++) {
                    var inter = getIntermediate(pattern[i - 1], pattern[i]);
                    if (inter !== null) {
                        var found = false;
                        for (var j = 0; j < i; j++) {
                            if (pattern[j] === inter) {
                                found = true;
                                break;
                            }
                        }
                        if (!found) return false;
                    }
                }
                return true;
            }

            // Compute Euclidean distance (total length) of the pattern.
            function computeTotalLength(pattern) {
                var total = 0;
                for (var i = 1; i < pattern.length; i++) {
                    var p1 = dotCoordinates[pattern[i - 1]];
                    var p2 = dotCoordinates[pattern[i]];
                    var dx = p2.x - p1.x;
                    var dy = p2.y - p1.y;
                    total += Math.sqrt(dx * dx + dy * dy);
                }
                return total;
            }

            // Helper: directional cross-product.
            function direction(xi, yi, xj, yj, xk, yk) {
                return (xk - xi) * (yj - yi) - (xj - xi) * (yk - yi);
            }

            // Check if two line segments (p1-p2 and p3-p4) intersect.
            function doLinesIntersect(x1, y1, x2, y2, x3, y3, x4, y4) {
                var d1 = direction(x3, y3, x4, y4, x1, y1);
                var d2 = direction(x3, y3, x4, y4, x2, y2);
                var d3 = direction(x1, y1, x2, y2, x3, y3);
                var d4 = direction(x1, y1, x2, y2, x4, y4);
                return ((d1 > 0 && d2 < 0) || (d1 < 0 && d2 > 0)) &&
                    ((d3 > 0 && d4 < 0) || (d3 < 0 && d4 > 0));
            }

            // Count intersections between non-adjacent segments.
            function countIntersections(pattern) {
                var intersections = 0;
                for (var i = 1; i < pattern.length; i++) {
                    var a = pattern[i - 1], b = pattern[i];
                    var p1 = dotCoordinates[a];
                    var p2 = dotCoordinates[b];
                    for (var j = 1; j < i - 1; j++) {
                        var c = pattern[j - 1], d = pattern[j];
                        var p3 = dotCoordinates[c];
                        var p4 = dotCoordinates[d];
                        if (doLinesIntersect(p1.x, p1.y, p2.x, p2.y, p3.x, p3.y, p4.x, p4.y)) {
                            intersections++;
                        }
                    }
                }
                return intersections;
            }

            // Count overlapping segments (a segment repeated regardless of direction).
            function countOverlaps(pattern) {
                var overlaps = 0;
                var segments = [];
                for (var i = 1; i < pattern.length; i++) {
                    var a = pattern[i - 1], b = pattern[i];
                    var seg = a < b ? (a + "-" + b) : (b + "-" + a);
                    if (segments.indexOf(seg) !== -1) {
                        overlaps++;
                    } else {
                        segments.push(seg);
                    }
                }
                return overlaps;
            }

            // Compute r using the formula: r = S * log₂(L + I + O)
            function computeR(pattern) {
                var S = pattern.length;
                var L = computeTotalLength(pattern);
                var I = countIntersections(pattern);
                var O = countOverlaps(pattern);
                var sum = L + I + O;
                if (sum <= 0) {
                    throw new Error("Invalid pattern: log₂ of non-positive value.");
                }
                var log2Value = Math.log(sum) / Math.log(2);
                return S * log2Value;
            }

            // Pattern Calculator Form Submission
            document.getElementById("patternForm").addEventListener("submit", function (e) {
                e.preventDefault();
                var input = document.getElementById("pattern").value.trim();
                var pattern = [];
                try {
                    // If input uses a comma, split on commas; otherwise, each character is a digit.
                    if (input.indexOf(",") !== -1) {
                        pattern = input.split(",").map(function (s) { return parseInt(s.trim(), 10); });
                    } else {
                        pattern = input.split("").map(function (ch) { return parseInt(ch, 10); });
                    }
                    // Check each number is between 1 and 9.
                    if (pattern.length < 2 || !pattern.every(function (n) { return n >= 1 && n <= 9; })) {
                        throw new Error("Please provide a valid pattern with at least two digits (each from 1 to 9).");
                    }
                    // Validate the pattern according to Android rules.
                    if (!isValidPattern(pattern)) {
                        throw new Error("Invalid pattern: This pattern does not follow Android lock rules.");
                    }
                    var S = pattern.length;
                    var L = computeTotalLength(pattern);
                    var I = countIntersections(pattern);
                    var O = countOverlaps(pattern);
                    var r = computeR(pattern);
                    document.getElementById("result").innerHTML =
                        "<h3>Calculated r Value: " + r.toFixed(3) + "</h3>" +
                        "<p><strong>S</strong> (dots used): " + S + "<br>" +
                        "<strong>L</strong> (total length): " + L.toFixed(3) + "<br>" +
                        "<strong>I</strong> (intersections): " + I + "<br>" +
                        "<strong>O</strong> (overlaps): " + O + "</p>";
                } catch (error) {
                    document.getElementById("result").innerHTML =
                        '<p style="color: red;">Error: ' + error.message + "</p>";
                    console.error(error);
                }
            });
        });
    </script>
</body>
</html>